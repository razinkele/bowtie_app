# Shiny Server Configuration for Bowtie Risk Analysis Application
# Version: 5.1.0

# Run as user shiny
run_as shiny;

# Define the server
server {
  # Listen on port 3838
  listen 3838;

  # Define the location of the application
  location / {
    # Host the directory of Shiny Apps stored in this directory
    site_dir /srv/shiny-server;

    # Log all Shiny output to files in this directory
    log_dir /var/log/shiny-server;

    # When a user visits the base URL rather than a particular application,
    # an index of the applications available in this directory will be shown.
    directory_index on;
  }

  # Application-specific settings
  location /bowtie_app {
    app_dir /srv/shiny-server/bowtie_app;
    log_dir /var/log/shiny-server;

    # Increase timeouts for long-running computations
    app_init_timeout 120;
    app_idle_timeout 300;

    # Allow reconnecting to existing sessions
    reconnect true;

    # Enable bookmarking for session state
    bookmark_state_dir /srv/shiny-server/bookmarks;
  }
}

# Global settings
# Maximum number of processes per application
simple_scheduler 15;

# Preserve logs
preserve_logs true;

# Access logs
access_log /var/log/shiny-server/access.log default;

# Sanitize errors (set to false for development)
sanitize_errors false;
